(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{2166:function(e){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"getCurrentUser"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticatedItem"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"stripeId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cart"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"quantity"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shortDescription"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"orders"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"charge"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"itemsCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"total"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"date"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"items"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"quantity"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shortDescription"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"ordersCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cartCount"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:608}};n.loc.source={body:"query getCurrentUser {\n  authenticatedItem {\n    ... on User {\n      email\n      id\n      name\n      stripeId\n      cart {\n        quantity\n        id\n        product {\n          id\n          price\n          shortDescription\n          title\n        }\n        user {\n          id\n        }\n      }\n      orders {\n        charge\n        id\n        itemsCount\n        total\n        date\n        items {\n          id\n          quantity\n          product {\n            id\n            price\n            title\n            shortDescription\n          }\n        }\n      }\n      ordersCount\n      cartCount\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};var t={};function i(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}n.definitions.forEach(function(e){if(e.name){var n=new Set;(function e(n,t){if("FragmentSpread"===n.kind)t.add(n.name.value);else if("VariableDefinition"===n.kind){var i=n.type;"NamedType"===i.kind&&t.add(i.name.value)}n.selectionSet&&n.selectionSet.selections.forEach(function(n){e(n,t)}),n.variableDefinitions&&n.variableDefinitions.forEach(function(n){e(n,t)}),n.definitions&&n.definitions.forEach(function(n){e(n,t)})})(e,n),t[e.name.value]=n}}),e.exports=n,e.exports.getCurrentUser=function(e,n){var r={kind:e.kind,definitions:[i(e,n)]};e.hasOwnProperty("loc")&&(r.loc=e.loc);var a=t[n]||new Set,s=new Set,d=new Set;for(a.forEach(function(e){d.add(e)});d.size>0;){var c=d;d=new Set,c.forEach(function(e){s.has(e)||(s.add(e),(t[e]||new Set).forEach(function(e){d.add(e)}))})}return s.forEach(function(n){var t=i(e,n);t&&r.definitions.push(t)}),r}(n,"getCurrentUser")},2100:function(e,n,t){Promise.resolve().then(t.bind(t,210))},210:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return N}});var i=t(3827),r=t(15),a=t(1911),s=t(6917),d=t(701),c=t.n(d),o=t(6120),u=t(300);function l(e){let{cart:n}=e,{formatted:t}=(0,o.w)(n);return(0,i.jsxs)("div",{className:c().cartListWrapper,children:[n.map(e=>(0,i.jsxs)("div",{className:c().cartItemWrapper,children:[(0,i.jsxs)("h4",{children:[e.product.title," x ",e.quantity]}),(0,i.jsx)("h4",{children:(0,u.Z)(e.product.price)})]},e.id)),(0,i.jsxs)("div",{className:c().totalsWrapper,children:[(0,i.jsx)("h4",{children:"Total:"}),(0,i.jsx)("h4",{children:t})]})]})}var m=t(4090),p=t(1889),v=t(1923);function f(e){let{stripeId:n}=e,t=(0,v.useStripe)(),r=(0,v.useElements)(),[a,s]=(0,m.useState)(null),[d,c]=(0,m.useState)(!1);(0,m.useEffect)(()=>{if(!t)return;let e=new URLSearchParams(window.location.search).get("payment_intent_client_secret");e&&t.retrievePaymentIntent(e).then(e=>{let{paymentIntent:n}=e;switch(null==n?void 0:n.status){case"succeeded":s("Payment succeeded!");break;case"processing":s("Your payment is processing.");break;case"requires_payment_method":s("Your payment was not successful, please try again.");break;default:s("Something went wrong.")}})},[t]);let o=async e=>{if(e.preventDefault(),!t||!r)return;let i=r.getElement("address"),a=await (null==i?void 0:i.getValue());await fetch("/api/update-customer-billing-address",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:a,stripeId:n})}).then(e=>e.json()),c(!0);let{error:d}=await t.confirmPayment({elements:r,confirmParams:{return_url:"http://localhost:3001/order/orderComplete"}});"card_error"===d.type||"validation_error"===d.type?s(d.message):s("An unexpected error occurred."),c(!1)};return(0,i.jsxs)("form",{id:"payment-form",onSubmit:o,children:[(0,i.jsx)(v.AddressElement,{id:"address-element",options:{mode:"shipping"}}),(0,i.jsx)(v.PaymentElement,{id:"payment-element",options:{layout:"tabs"}}),(0,i.jsx)("button",{disabled:d||!t||!r,id:"submit",children:(0,i.jsx)("span",{id:"button-text",children:d?(0,i.jsx)("div",{className:"spinner",id:"spinner"}):"Pay now"})}),a&&(0,i.jsx)("div",{id:"payment-message",children:a})]})}var k=t(3155),h=t(9421),g=t.n(h);let S=(0,p.J)("pk_test_51ObRbiBl2y7GPat6uFsMQ6hh7y6d3BmkzvIQCw2XklzJGS58LlkOOSxYTZVSeYAM1ut87Z1yIES8STDnvGkR3eoX00Np6K1qlA");function y(e){let{user:n}=e,[t,r]=(0,m.useState)(""),{cart:a,stripeId:s=""}=n,d=a.map(e=>({id:e.id,amount:e.product.price,title:e.product.title,quantity:e.quantity,product:{price:e.product.price}}));return(0,m.useEffect)(()=>{fetch("/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:d,stripeId:null==n?void 0:n.stripeId,elements:v.Elements})}).then(e=>e.json()).then(e=>r(e.clientSecret))},[]),(0,i.jsxs)("div",{className:g().paymentWrapper,children:[t&&(0,i.jsx)(v.Elements,{options:{clientSecret:t,appearance:{theme:"stripe"}},stripe:S,children:(0,i.jsx)(f,{stripeId:s})}),!t&&(0,i.jsx)(k.Z,{})]})}function N(){let e=(0,s.a)();return(0,i.jsx)(r.MenuStateProvider,{children:(0,i.jsxs)("main",{children:[(0,i.jsx)(a.Z,{text:"Checkout",subText:"Look over your order and make sure everything looks correct before making your purchase. Then enter you credit card information down below."}),e&&(null==e?void 0:e.cart.length)>0&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l,{cart:e.cart}),(0,i.jsx)(y,{user:e})]}),e&&0===e.cart.length&&(0,i.jsx)("p",{children:"You have no items in your cart..."})]})})}},3155:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var i=t(3827),r=t(6775),a=t.n(r);function s(){return(0,i.jsx)("div",{className:a().loadingWrapper,children:(0,i.jsx)("img",{src:"/loading-icon.png",alt:"Loading something good...",className:a().image})})}},1911:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var i=t(3827),r=t(1044),a=t.n(r),s=t(5710),d=t.n(s);function c(e){let{text:n,subText:t}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h1",{className:"".concat(a().className," ").concat(d().h1),children:n}),(0,i.jsx)("p",{className:d().p,children:t})]})}},6917:function(e,n,t){"use strict";t.d(n,{a:function(){return s}});var i=t(8622),r=t(2166),a=t.n(r);function s(){let{data:e,loading:n,error:t}=(0,i.a)(a());return null==e?void 0:e.authenticatedItem}},6120:function(e,n,t){"use strict";t.d(n,{w:function(){return r}});var i=t(300);function r(e){let n=e.reduce((e,n)=>n.product?e+n.quantity*n.product.price:e,0);return{price:n,formatted:(0,i.Z)(n)}}},300:function(e,n,t){"use strict";function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n={style:"currency",currency:"USD",minimumFractionDigits:2};return e%100==0&&(n.minimumFractionDigits=0),Intl.NumberFormat("en-US",n).format(e/100)}t.d(n,{Z:function(){return i}})},15:function(e,n,t){"use strict";t.r(n),t.d(n,{MenuStateProvider:function(){return d},useMenu:function(){return c}});var i=t(3827),r=t(4090);let a=(0,r.createContext)({}),s=a.Provider;function d(e){let{children:n}=e,[t,a]=(0,r.useState)(!1),[d,c]=(0,r.useState)(!1);return(0,i.jsx)(s,{value:{isMenuOpen:t,setIsMenuOpen:a,closeMenu:function(){a(!1)},openMenu:function(){a(!0)},toggleMenu:function(){a(!t)},isCartOpen:d,setIsCartOpen:c,toggleCart:function(){c(!t)},closeCart:function(){c(!1)},openCart:function(){c(!0)}},children:n})}function c(){return(0,r.useContext)(a)}},701:function(e){e.exports={cartListWrapper:"cartList_cartListWrapper__4dine",cartItemWrapper:"cartList_cartItemWrapper__I8xNw",totalsWrapper:"cartList_totalsWrapper__8x2J7"}},6775:function(e){e.exports={loadingWrapper:"loadingSpinner_loadingWrapper__5wKXB",image:"loadingSpinner_image__EpZBJ",infiniteSpin:"loadingSpinner_infiniteSpin__vK_mp"}},9421:function(e){e.exports={paymentWrapper:"payment_paymentWrapper__5l9I6"}},5710:function(e){e.exports={h1:"sectionHeader_h1___lmyj",p:"sectionHeader_p__y_jXV"}}},function(e){e.O(0,[28,916,204,971,69,744],function(){return e(e.s=2100)}),_N_E=e.O()}]);